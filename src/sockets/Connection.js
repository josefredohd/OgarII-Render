const _0x43985f=_0x4ce8;function _0x4ce8(_0x39fd1f,_0x4bb4aa){const _0x3b2019=_0x3b20();return _0x4ce8=function(_0x4ce80f,_0x3fcbb3){_0x4ce80f=_0x4ce80f-0x1a0;let _0xf849f1=_0x3b2019[_0x4ce80f];return _0xf849f1;},_0x4ce8(_0x39fd1f,_0x4bb4aa);}(function(_0x1fc1ff,_0x15c7d7){const _0x515c0f=_0x4ce8,_0x213522=_0x1fc1ff();while(!![]){try{const _0x16bbf3=-parseInt(_0x515c0f(0x1c1))/0x1*(parseInt(_0x515c0f(0x1e6))/0x2)+parseInt(_0x515c0f(0x1ab))/0x3+parseInt(_0x515c0f(0x1b3))/0x4+-parseInt(_0x515c0f(0x1ef))/0x5+parseInt(_0x515c0f(0x1f2))/0x6+parseInt(_0x515c0f(0x1fa))/0x7+parseInt(_0x515c0f(0x1cc))/0x8*(parseInt(_0x515c0f(0x1c5))/0x9);if(_0x16bbf3===_0x15c7d7)break;else _0x213522['push'](_0x213522['shift']());}catch(_0x1cab9c){_0x213522['push'](_0x213522['shift']());}}}(_0x3b20,0x2bf89));function _0x3b20(){const _0x5c4faa=['type','globalChat','tick','hasWorld','execute','processAuthentication','connectTime','_socket','onWorldReset','fredo123','border','webSocket','viewArea','isPressingQ','slice','now','authTimeout','directMessage','onChatMessage','controllingMinions','spawningName','10872Siurqu','hasProcessedQ','closeCode','handle','listener','onNewWorldBounds','onDisconnection','Authentication\x20timeout','481700uycCnF','eatenBy','push','minionEnableQBasedControl','passwordVerified','chatCommands','minions','toggleQueued','requestingSpectate','minionState','closeSocket','matchmakerNeedsQueuing','socketDisconnected','add','15259DnqTEf','bind','processProtocolMessage','hasPlayer','36Pzaudg','world','player','upgradeLevel','gamemode','hasOwnProperty','createPlayer','492568kAMEqv','ejectAttempts','onSocketMessage','./Listener','updateVisibleCells','Manual\x20connection\x20close\x20call','closeReason','length','send','pong','lastChatTime','./Router','splitAttempts','message','lastVisibleCells','unknown\x20command,\x20execute\x20/help\x20for\x20the\x20list\x20of\x20commands','state','exports','ping','onNewOwnedCell','connection','settings','protocol','trim','onSocketClose','Try\x20spawning\x20to\x20enqueue.','12bqVbhK','lastActivityTime','sendLeaderboard','../protocols/Protocol','onWorldSet','onVisibleCellUpdate','decide','remoteAddress','onQPress','1174775PgOLAv','isExternal','disconnected','508206WaHSjX','from','update','../primitives/Reader','matchmaker','This\x20server\x20requires\x20players\x20to\x20be\x20queued.','Authentication\x20protocol\x20error','fromCharCode','361060gPtXrK','separateInTeams','close','Invalid\x20password','protocols','chatEnabled','\x20has\x20disconnected'];_0x3b20=function(){return _0x5c4faa;};return _0x3b20();}const Router=require(_0x43985f(0x1d7)),Reader=require(_0x43985f(0x1f5)),{filterIPAddress}=require('../primitives/Misc');class Connection extends Router{constructor(_0x383fba,_0x2dc628){const _0x20cfc5=_0x43985f;super(_0x383fba),this['remoteAddress']=filterIPAddress(_0x2dc628[_0x20cfc5(0x208)][_0x20cfc5(0x1ed)]),this['webSocket']=_0x2dc628,this[_0x20cfc5(0x207)]=Date[_0x20cfc5(0x1a5)](),this[_0x20cfc5(0x1e7)]=Date[_0x20cfc5(0x1a5)](),this[_0x20cfc5(0x1d6)]=Date[_0x20cfc5(0x1a5)](),this[_0x20cfc5(0x1c8)]=0x0,this[_0x20cfc5(0x1e2)]=null,this[_0x20cfc5(0x1bf)]=![],this['closeCode']=NaN,this[_0x20cfc5(0x1d2)]=null,this[_0x20cfc5(0x1b9)]=[],this['minionsFrozen']=![],this[_0x20cfc5(0x1a9)]=![],this[_0x20cfc5(0x1bc)]=0x0,this[_0x20cfc5(0x1b7)]=![],this['authTimeout']=setTimeout(()=>{const _0x15cdf7=_0x20cfc5;!this[_0x15cdf7(0x1b7)]&&!this['socketDisconnected']&&this['closeSocket'](0xfa1,_0x15cdf7(0x1b2));},0x1388),_0x2dc628['on'](_0x20cfc5(0x1fc),this[_0x20cfc5(0x1e4)][_0x20cfc5(0x1c2)](this)),_0x2dc628['on'](_0x20cfc5(0x1d9),this[_0x20cfc5(0x1ce)][_0x20cfc5(0x1c2)](this)),_0x2dc628['on'](_0x20cfc5(0x1de),this['closeSocket'][_0x20cfc5(0x1c2)](this,0x3eb,'Unexpected\x20message\x20format')),_0x2dc628['on'](_0x20cfc5(0x1d5),this[_0x20cfc5(0x1bd)][_0x20cfc5(0x1c2)](this,0x3eb,'Unexpected\x20message\x20format'));}[_0x43985f(0x1fc)](){const _0x206845=_0x43985f;if(!this[_0x206845(0x1bf)])return void this[_0x206845(0x1bd)](0x3e9,_0x206845(0x1d1));super['close'](),this[_0x206845(0x1f1)]=!![],this['disconnectionTick']=this[_0x206845(0x1ae)][_0x206845(0x203)],this[_0x206845(0x1af)][_0x206845(0x1b1)](this,this[_0x206845(0x1ad)],this[_0x206845(0x1d2)]),this['webSocket']['removeAllListeners']();}static get[_0x43985f(0x201)](){const _0x4a1c92=_0x43985f;return _0x4a1c92(0x1e0);}static get[_0x43985f(0x1f0)](){return!![];}static get[_0x43985f(0x1fb)](){return!![];}[_0x43985f(0x1e4)](_0x400fd7,_0xf3de46){const _0x6cf1dd=_0x43985f;if(this[_0x6cf1dd(0x1bf)])return;this['logger']['debug']('connection\x20from\x20'+this[_0x6cf1dd(0x1ed)]+_0x6cf1dd(0x200)),this['socketDisconnected']=!![],this['closeCode']=_0x400fd7,this[_0x6cf1dd(0x1d2)]=_0xf3de46;}[_0x43985f(0x1ce)](_0x3f9a01){const _0x3d917a=_0x43985f;this[_0x3d917a(0x1e7)]=Date[_0x3d917a(0x1a5)]();if(!this[_0x3d917a(0x1b7)]){this[_0x3d917a(0x206)](_0x3f9a01);return;}this[_0x3d917a(0x1c3)](_0x3f9a01);}[_0x43985f(0x206)](_0x5dfcbb){const _0x14339c=_0x43985f;try{const _0xf7ba8=Buffer[_0x14339c(0x1f3)](_0x5dfcbb);let _0x1d6b16='',_0x473f8d=0x0;while(_0x473f8d<_0xf7ba8['length']&&_0xf7ba8[_0x473f8d]!==0x0){_0x1d6b16+=String[_0x14339c(0x1f9)](_0xf7ba8[_0x473f8d]),_0x473f8d++;}if(_0x1d6b16===_0x14339c(0x20a)){this[_0x14339c(0x1b7)]=!![],clearTimeout(this[_0x14339c(0x1a6)]);const _0x50e16f=Buffer[_0x14339c(0x1f3)]([0x1]);this[_0x14339c(0x1a1)][_0x14339c(0x1d4)](_0x50e16f);if(_0x473f8d<_0xf7ba8[_0x14339c(0x1d3)]-0x1){const _0x452b8f=_0xf7ba8['slice'](_0x473f8d+0x1);_0x452b8f[_0x14339c(0x1d3)]>0x0&&setTimeout(()=>{this['processProtocolMessage'](_0x452b8f);},0x32);}}else this['closeSocket'](0xfa1,_0x14339c(0x1fd));}catch(_0x55300d){this['closeSocket'](0xfa2,_0x14339c(0x1f8));}}[_0x43985f(0x1c3)](_0x36f6ca){const _0x184406=_0x43985f;try{const _0x155cf1=Buffer[_0x184406(0x1f3)](_0x36f6ca);if(_0x155cf1[_0x184406(0x1d3)]===0x0)return;const _0x191e05=new Reader(_0x155cf1,0x0);if(this[_0x184406(0x1e2)]!==null)this[_0x184406(0x1e2)]['onSocketMessage'](_0x191e05);else{this[_0x184406(0x1e2)]=this[_0x184406(0x1ae)][_0x184406(0x1fe)][_0x184406(0x1ec)](this,_0x191e05);if(this[_0x184406(0x1e2)]===null){}else{}}}catch(_0x6a4f1c){}}[_0x43985f(0x1cb)](){const _0x1f541e=_0x43985f;super['createPlayer']();if(this[_0x1f541e(0x1e1)][_0x1f541e(0x1ff)])this['listener']['globalChat'][_0x1f541e(0x1c0)](this);if(this[_0x1f541e(0x1e1)][_0x1f541e(0x1be)])this[_0x1f541e(0x1af)][_0x1f541e(0x202)][_0x1f541e(0x1a7)](null,this,_0x1f541e(0x1f7)),this[_0x1f541e(0x1af)][_0x1f541e(0x202)][_0x1f541e(0x1a7)](null,this,_0x1f541e(0x1e5));else this[_0x1f541e(0x1ae)][_0x1f541e(0x1f6)][_0x1f541e(0x1ba)](this);}[_0x43985f(0x1a8)](_0x269d5b){const _0x14a938=_0x43985f;_0x269d5b=_0x269d5b[_0x14a938(0x1e3)]();if(!_0x269d5b)return;const _0x1dd64e=this[_0x14a938(0x1af)][_0x14a938(0x202)],_0x4ee18e=this[_0x14a938(0x1d6)];this[_0x14a938(0x1d6)]=Date[_0x14a938(0x1a5)]();if(_0x269d5b['length']>=0x2&&_0x269d5b[0x0]==='/'){if(!this['handle'][_0x14a938(0x1b8)][_0x14a938(0x205)](this,_0x269d5b[_0x14a938(0x1a4)](0x1)))_0x1dd64e['directMessage'](null,this,_0x14a938(0x1db));}else{if(Date[_0x14a938(0x1a5)]()-_0x4ee18e>=this[_0x14a938(0x1e1)]['chatCooldown'])_0x1dd64e['broadcast'](this,_0x269d5b);}}[_0x43985f(0x1ee)](){const _0x585edf=_0x43985f;if(!this['hasPlayer'])return;if(this[_0x585edf(0x1af)][_0x585edf(0x1e1)][_0x585edf(0x1b6)]&&this['minions'][_0x585edf(0x1d3)]>0x0)this[_0x585edf(0x1a9)]=!this[_0x585edf(0x1a9)];else this[_0x585edf(0x1ae)][_0x585edf(0x1c9)]['whenPlayerPressQ'](this[_0x585edf(0x1c7)]);}get['shouldClose'](){const _0x32650e=_0x43985f;return this[_0x32650e(0x1bf)];}[_0x43985f(0x1f4)](){const _0x15e65a=_0x43985f;if(!this[_0x15e65a(0x1c4)])return;if(!this[_0x15e65a(0x1c7)][_0x15e65a(0x204)]){if(this[_0x15e65a(0x1aa)]!==null)this[_0x15e65a(0x1ae)][_0x15e65a(0x1f6)][_0x15e65a(0x1ba)](this);this[_0x15e65a(0x1aa)]=null,this[_0x15e65a(0x1d8)]=0x0,this[_0x15e65a(0x1cd)]=0x0,this[_0x15e65a(0x1bb)]=![],this[_0x15e65a(0x1a3)]=![],this[_0x15e65a(0x1ac)]=![];return;}this[_0x15e65a(0x1c7)][_0x15e65a(0x1d0)]();const _0x4c5d8f=[],_0x53ed96=[],_0x5d486d=[],_0x31374e=[],_0x3b8cce=this[_0x15e65a(0x1c7)],_0x2401e5=_0x3b8cce['visibleCells'],_0x420b4f=_0x3b8cce[_0x15e65a(0x1da)];for(let _0x336416 in _0x2401e5){const _0x4bee8e=_0x2401e5[_0x336416];if(!_0x420b4f['hasOwnProperty'](_0x336416))_0x4c5d8f[_0x15e65a(0x1b5)](_0x4bee8e);else{if(_0x4bee8e['shouldUpdate'])_0x53ed96[_0x15e65a(0x1b5)](_0x4bee8e);}}for(let _0x35d26e in _0x420b4f){const _0x158aaf=_0x420b4f[_0x35d26e];if(_0x2401e5[_0x15e65a(0x1ca)](_0x35d26e))continue;if(_0x158aaf[_0x15e65a(0x1b4)]!==null)_0x5d486d[_0x15e65a(0x1b5)](_0x158aaf);_0x31374e[_0x15e65a(0x1b5)](_0x158aaf);}if(_0x3b8cce[_0x15e65a(0x1dc)]===0x1||_0x3b8cce['state']===0x2)this[_0x15e65a(0x1e2)]['onSpectatePosition'](_0x3b8cce[_0x15e65a(0x1a2)]);if(this[_0x15e65a(0x1ae)]['tick']%0x4===0x0)this[_0x15e65a(0x1ae)]['gamemode'][_0x15e65a(0x1e8)](this);this['protocol'][_0x15e65a(0x1eb)](_0x4c5d8f,_0x53ed96,_0x5d486d,_0x31374e);}[_0x43985f(0x1ea)](){const _0x3dcbed=_0x43985f;this[_0x3dcbed(0x1e2)][_0x3dcbed(0x1b0)](this['player'][_0x3dcbed(0x1c6)][_0x3dcbed(0x1a0)],!![],this[_0x3dcbed(0x1e2)]);}[_0x43985f(0x1df)](_0x1b61a2){const _0x40b5c1=_0x43985f;this['protocol'][_0x40b5c1(0x1df)](_0x1b61a2);}['onWorldReset'](){const _0x36a97d=_0x43985f;this[_0x36a97d(0x1e2)][_0x36a97d(0x209)]();}['send'](_0x2cb567){const _0x246c69=_0x43985f;if(this[_0x246c69(0x1bf)]||!this[_0x246c69(0x1b7)])return;this[_0x246c69(0x1a1)][_0x246c69(0x1d4)](_0x2cb567);}[_0x43985f(0x1bd)](_0x81e553,_0x2c95e2){const _0x158700=_0x43985f;if(this[_0x158700(0x1bf)])return;this[_0x158700(0x1bf)]=!![],this[_0x158700(0x1ad)]=_0x81e553,this[_0x158700(0x1d2)]=_0x2c95e2,clearTimeout(this[_0x158700(0x1a6)]),this[_0x158700(0x1a1)][_0x158700(0x1fc)](_0x81e553||0x3ee,_0x2c95e2||'');}}module[_0x43985f(0x1dd)]=Connection;const WebSocket=require('ws'),Listener=require(_0x43985f(0x1cf)),Minion=require('../bots/Minion'),Protocol=require(_0x43985f(0x1e9));
